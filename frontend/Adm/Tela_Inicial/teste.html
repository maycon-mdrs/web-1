<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <title>CRUD com Modal</title>
</head>

<body>
    <div class="container mt-5">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Adicionar Item
        </button>

        <div id="items-list" class="mt-3">
            <!-- Lista de itens será adicionada aqui -->
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Add Link</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <form class="row g-3 needs-validation" id="links-form" novalidate>
                    <input type="hidden" id="item-id">

                    <div class="col-6">
                        <label for="validationCustom01" class="form-label">Título</label>
                        <input type="text" class="form-control" id="validationCustom01" required>
                        <div class="invalid-feedback">
                            Insira um título.
                        </div>
                    </div>

                    <div class="col-6">
                        <label for="validationCustom02" class="form-label">Ícone</label>
                        <select class="form-select" id="validationCustom02" required>
                            <option selected disabled value="">Selecionar</option>
                            <option value="1">Cardápio</option>
                            <option value="2">Instagram</option>
                            <option value="3">Ifood</option>
                            <option value="4">Nenhum</option>
                        </select>
                        <div class="invalid-feedback">
                            Selecione um ícone válido.
                        </div>
                    </div>

                    <div class="col-12">
                        <label for="validationCustom03" class="form-label">URL</label>
                        <div class="input-group">
                            <span class="input-group-text" id="basic-addon1">https://</span>
                            <input type="text" class="form-control" id="validationCustom03" placeholder="www.name.com" required>
                            <div class="invalid-feedback">
                                Insira um endereço.
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <button class="btn btn-primary" type="submit">
                            Adicionar
                        </button>
                    </div>

                </form>

            </div>
        </div>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Confirmação</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Deseja realmente excluir este item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            let itemCount = 0;

            // Manipula o evento de submit do formulário
            $('#links-form').submit(function (e) {
                e.preventDefault();

                if (!this.checkValidity()) {
                    e.stopPropagation();
                    $(this).addClass('was-validated');
                    return;
                }

                const itemId = $('#item-id').val();
                const title = $('#validationCustom01').val();
                const icon = $('#validationCustom02').val();
                const url = $('#validationCustom03').val();

                if (itemId) {
                    // Editar item existente
                    $('#' + itemId).find('.item-title').text(title);
                    $('#' + itemId).find('.item-url').text(url);
                    $('#' + itemId).find('.item-icon').text(icon);
                } else {
                    // Adicionar novo item
                    const newItem = `
                        <div id="item-${itemCount}" class="mt-3">
                            <span class="item-title">${title}</span>
                            <span class="item-url">${url}</span>
                            <span class="item-icon">${icon}</span>
                            <button type="button" class="btn btn-primary edit-btn" data-bs-toggle="modal"
                                data-bs-target="#exampleModal" data-item-id="item-${itemCount}">
                                Editar
                            </button>
                            <button type="button" class="btn btn-danger delete-btn" data-bs-toggle="modal"
                                data-bs-target="#confirmationModal" data-item-id="item-${itemCount}">
                                Excluir
                            </button>
                        </div>
                    `;

                    $('#items-list').append(newItem);
                    itemCount++;
                }

                // Limpar o formulário e fechar o modal
                $(this).removeClass('was-validated').trigger('reset');
                $('#item-id').val('');
                $('#exampleModal').modal('hide');
            });

            // Manipula o evento de clique no botão "Editar"
            $(document).on('click', '.edit-btn', function () {
                const itemId = $(this).data('item-id');
                const title = $('#' + itemId).find('.item-title').text();
                const url = $('#' + itemId).find('.item-url').text();
                const icon = $('#' + itemId).find('.item-icon').text();

                $('#item-id').val(itemId);
                $('#validationCustom01').val(title);
                $('#validationCustom02').val(icon);
                $('#validationCustom03').val(url);

                $('#exampleModal').modal('show');
            });

            // Manipula o evento de clique no botão "Excluir"
            $(document).on('click', '.delete-btn', function () {
                const itemId = $(this).data('item-id');
                $('#confirmationModal').data('item-id', itemId).modal('show');
            });

            // Manipula o evento de clique no botão "Excluir" no modal de confirmação
            $('#confirmDelete').click(function () {
                const itemId = $('#confirmationModal').data('item-id');
                $('#' + itemId).remove();
                $('#confirmationModal').modal('hide');
            });

            // Reseta o formulário e validação ao fechar o modal
            $('#exampleModal').on('hidden.bs.modal', function () {
                $('#links-form').removeClass('was-validated').trigger('reset');
                $('#item-id').val('');
            });
        });
    </script>
</body>

</html>
